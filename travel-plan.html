<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2026 LA & Cruise | Travel App</title>
    <!-- Vue 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link
        href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700;900&family=Noto+Sans+TC:wght@300;400;500;700&display=swap"
        rel="stylesheet">
    <!-- Phosphor Icons -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <!-- Leaflet CSS & JS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>

    <style>
        body {
            font-family: 'Noto Sans TC', 'Noto Sans JP', sans-serif;
            background-color: #F3F4F6;
            -webkit-tap-highlight-color: transparent;
        }

        .hide-scroll::-webkit-scrollbar {
            display: none;
        }

        .hide-scroll {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .fade-enter-active,
        .fade-leave-active {
            transition: opacity 0.3s ease;
        }

        .fade-enter-from,
        .fade-leave-to {
            opacity: 0;
        }

        #map-container {
            z-index: 1;
        }

        .gps-pulse {
            width: 14px;
            height: 14px;
            border: 2px solid #fff;
            border-radius: 50%;
            background-color: #3b82f6;
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.4);
            animation: pulse-blue 2s infinite;
        }

        @keyframes pulse-blue {
            0% {
                box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7);
            }

            70% {
                box-shadow: 0 0 0 10px rgba(59, 130, 246, 0);
            }

            100% {
                box-shadow: 0 0 0 0 rgba(59, 130, 246, 0);
            }
        }

        .leaflet-popup-content-wrapper {
            border-radius: 12px;
            padding: 0;
            overflow: hidden;
        }

        .leaflet-popup-content {
            margin: 0;
            width: 200px !important;
        }

        .prose ul {
            list-style-type: disc;
            padding-left: 1.2rem;
        }

        .prose li {
            margin-bottom: 0.2rem;
        }
    </style>
</head>

<body class="text-slate-700 h-screen flex flex-col overflow-hidden">

    <div id="app"
        class="flex flex-col h-full max-w-md mx-auto w-full bg-white shadow-2xl relative sm:rounded-xl sm:my-4 sm:h-[95vh] sm:border-4 sm:border-slate-100">

        <!-- Header -->
        <header class="bg-indigo-900 text-white shrink-0 z-20 shadow-md">
            <div class="p-4 flex justify-between items-center">
                <div class="flex items-center gap-3 overflow-hidden">
                    <div class="overflow-hidden">
                        <h1 class="text-base sm:text-lg font-bold tracking-wide flex items-center gap-2 truncate">
                            ğŸ‡ºğŸ‡¸ 2026 ç¾åœ‹è¡Œ <span
                                class="text-[10px] bg-indigo-700 px-1.5 py-0.5 rounded text-indigo-200 whitespace-nowrap">LA
                                & Cruise</span>
                        </h1>
                        <p class="text-xs text-indigo-200 mt-0.5 font-light tracking-wider truncate">2/11 - 2/24 (14å¤©)
                        </p>
                    </div>
                </div>
                <div class="flex items-center gap-2 shrink-0 ml-2">
                    <!-- Google Maps å¤–é€£æŒ‰éˆ• -->
                    <a href="https://www.google.com/maps/d/u/0/edit?mid=1t8mZMS8VSCAJKqJiClO2UfADz9RPchs&ll=26.747109881469584%2C-111.86976465000001&z=5"
                        target="_blank"
                        class="bg-indigo-800/50 p-2 rounded-lg text-indigo-200 hover:text-white transition-all flex items-center justify-center"
                        title="é–‹å•Ÿ Google æˆ‘çš„åœ°åœ–">
                        <i class="ph-bold ph-arrow-square-out text-lg"></i>
                    </a>

                    <!-- è¦–åœ–åˆ‡æ› -->
                    <div class="flex bg-indigo-800/50 p-1 rounded-lg ml-1">
                        <button @click="viewMode = 'plan'"
                            :class="viewMode === 'plan' ? 'bg-white text-indigo-900 shadow-sm' : 'text-indigo-300'"
                            class="p-2 rounded-md transition-all"><i
                                class="ph-bold ph-calendar-check text-lg"></i></button>
                        <button @click="viewMode = 'guide'"
                            :class="viewMode === 'guide' ? 'bg-white text-indigo-900 shadow-sm' : 'text-indigo-300'"
                            class="p-2 rounded-md transition-all"><i class="ph-bold ph-boat text-lg"></i></button>
                        <button @click="viewMode = 'shop'"
                            :class="viewMode === 'shop' ? 'bg-white text-indigo-900 shadow-sm' : 'text-indigo-300'"
                            class="p-2 rounded-md transition-all"><i
                                class="ph-bold ph-list-checks text-lg"></i></button>
                        <button @click="viewMode = 'map'"
                            :class="viewMode === 'map' ? 'bg-white text-indigo-900 shadow-sm' : 'text-indigo-300'"
                            class="p-2 rounded-md transition-all"><i
                                class="ph-bold ph-map-trifold text-lg"></i></button>
                    </div>
                </div>
            </div>

            <!-- æ—¥æœŸæ»‘å‹•åˆ— (åƒ…åœ¨è¡Œç¨‹æ¨¡å¼é¡¯ç¤º) -->
            <div v-if="viewMode === 'plan'" class="flex overflow-x-auto hide-scroll px-2 pb-3 space-x-2 snap-x">
                <div v-for="(day, index) in days" :key="index" @click="currentDayIdx = index"
                    class="snap-center shrink-0 flex flex-col items-center justify-center w-14 h-16 rounded-xl cursor-pointer transition-all border-2"
                    :class="currentDayIdx === index ? 'bg-white text-indigo-900 border-white shadow-lg scale-105' : 'bg-indigo-800/40 text-indigo-200 border-transparent hover:bg-indigo-700'">
                    <span class="text-[10px] font-medium opacity-80">{{ day.shortDate }}</span>
                    <span class="text-base font-bold">D{{ index + 1 }}</span>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="flex-1 overflow-y-auto bg-slate-50 relative hide-scroll">

            <!-- VIEW: è¡Œç¨‹è¡¨ (Plan) -->
            <transition name="fade" mode="out-in">
                <div v-if="viewMode === 'plan'" :key="currentDayIdx" class="p-4 pb-24">
                    <div class="bg-white p-4 rounded-2xl shadow-sm mb-4 border border-slate-100">
                        <div class="flex justify-between items-start">
                            <div>
                                <h2 class="text-2xl font-bold text-slate-800">{{ currentDay.date }}</h2>
                                <input v-model="currentDay.title"
                                    class="text-sm font-medium text-indigo-600 w-full mt-1 bg-transparent border-none p-0 focus:ring-0"
                                    placeholder="è¼¸å…¥ç•¶æ—¥ä¸»é¡Œ">
                            </div>
                            <!-- å¤©æ°£é¡¯ç¤º (API é€£å‹•) -->
                            <div class="text-right">
                                <div v-if="weather.temp" class="flex flex-col items-end animate-pulse-once">
                                    <div class="flex items-center justify-end gap-1 text-indigo-500">
                                        <i class="text-2xl" :class="weatherIcon"></i>
                                        <span class="text-xl font-bold font-mono">{{ weather.temp }}Â°C</span>
                                    </div>
                                    <span class="text-[10px] text-slate-400">LA å³æ™‚æ°£æº«</span>
                                </div>
                                <div v-else class="text-xs text-slate-300 flex items-center gap-1">
                                    <i class="ph-duotone ph-spinner animate-spin"></i> è¼‰å…¥å¤©æ°£...
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- èˆªç­å¡ç‰‡ -->
                    <div v-if="currentDay.flight"
                        class="mb-6 relative bg-gradient-to-r from-sky-600 to-indigo-600 rounded-2xl text-white shadow-lg overflow-hidden group">
                        <button @click="currentDay.flight = null"
                            class="absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition text-white/70 hover:text-white"><i
                                class="ph-bold ph-x"></i></button>
                        <div class="p-4 relative z-0">
                            <div class="flex justify-between items-center mb-1 pt-1">
                                <div class="flex flex-col items-center w-1/3">
                                    <div class="text-2xl font-black font-mono">{{ currentDay.flight.startTime }}</div>
                                    <div class="text-[10px] opacity-80">å‡ºç™¼</div>
                                    <div class="text-sm font-bold opacity-90">{{ currentDay.flight.startAirport }}</div>
                                </div>
                                <div class="flex flex-col items-center justify-center w-1/3 px-2">
                                    <i
                                        class="ph-fill ph-airplane text-2xl mb-1 transform rotate-90 text-yellow-300"></i>
                                    <div class="text-[10px] font-mono tracking-widest opacity-80">{{
                                        currentDay.flight.number }}</div>
                                </div>
                                <div class="flex flex-col items-center w-1/3">
                                    <div class="text-2xl font-black font-mono">{{ currentDay.flight.endTime }}</div>
                                    <div class="text-[10px] opacity-80">æŠµé” <span
                                            v-if="currentDay.flight.arrivalOffset!=0"
                                            class="bg-red-500 px-1 rounded text-[8px] font-bold">{{
                                            currentDay.flight.arrivalOffset > 0 ? '+1' : '-1' }}</span></div>
                                    <div class="text-sm font-bold opacity-90">{{ currentDay.flight.endAirport }}</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- è¡Œç¨‹åˆ—è¡¨ -->
                    <div class="relative pl-4 border-l-2 border-indigo-100 space-y-6">
                        <div v-for="(item, idx) in currentDay.items" :key="idx" class="relative group">
                            <div class="absolute -left-[21px] top-3 w-3 h-3 rounded-full border-2 border-white shadow-sm"
                                :class="getDotColor(item.type)"></div>
                            <div
                                class="bg-white p-3 rounded-xl shadow-sm border border-slate-100 hover:shadow-md transition-shadow">
                                <div class="flex items-start gap-3">
                                    <!-- æ™‚é–“ -->
                                    <div class="flex flex-col items-center w-14 shrink-0 pt-1 relative">
                                        <div
                                            class="text-sm font-bold text-slate-700 font-mono leading-none tracking-tight h-6 flex items-center justify-center w-full">
                                            {{ item.time || '--:--' }}
                                        </div>
                                        <input v-model="item.time" type="time"
                                            class="absolute inset-0 w-full h-full opacity-0 z-10 cursor-pointer">
                                        <div
                                            class="text-[10px] text-slate-400 font-medium bg-slate-100 px-1.5 py-0.5 rounded mt-1 whitespace-nowrap">
                                            {{ getTypeLabel(item.type) }}</div>
                                    </div>

                                    <!-- å…§å®¹ -->
                                    <div class="flex-1 min-w-0">
                                        <input v-model="item.activity"
                                            class="block w-full font-bold text-slate-800 bg-transparent border-none p-0 focus:ring-0"
                                            placeholder="è¡Œç¨‹åç¨±...">
                                        <div class="flex items-center gap-1 mt-1">
                                            <i class="ph-fill ph-map-pin text-indigo-400 text-xs"></i>
                                            <input v-model="item.location"
                                                class="flex-1 text-xs text-slate-500 bg-transparent border-none p-0 focus:ring-0 truncate"
                                                placeholder="åœ°é»">
                                        </div>
                                        <div class="flex items-center gap-1 mt-1">
                                            <i class="ph-bold ph-info text-orange-400 text-xs"></i>
                                            <input v-model="item.note"
                                                class="flex-1 text-xs text-orange-600/90 bg-transparent border-none p-0 focus:ring-0 truncate"
                                                placeholder="å‚™è¨»">
                                        </div>
                                        <!-- é€£çµæŒ‰éˆ• (å¦‚æœæ˜¯é€£çµé¡å‹) -->
                                        <a v-if="item.link" :href="item.link" target="_blank"
                                            class="mt-2 inline-flex items-center gap-1 text-xs bg-indigo-50 text-indigo-600 px-2 py-1 rounded-lg border border-indigo-100 hover:bg-indigo-100">
                                            <i class="ph-bold ph-house-line"></i> æŸ¥çœ‹è©³æƒ…/é è¨‚
                                        </a>
                                    </div>
                                    <!-- æ“ä½œ -->
                                    <div class="flex flex-col gap-2">
                                        <a v-if="item.location"
                                            :href="`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(item.location)}`"
                                            target="_blank" class="text-indigo-500 hover:bg-indigo-50 p-1.5 rounded"><i
                                                class="ph-bold ph-navigation-arrow"></i></a>
                                        <button @click="removeItem(idx)"
                                            class="text-slate-300 hover:text-red-500 p-1.5 rounded"><i
                                                class="ph-bold ph-trash"></i></button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <button @click="addItem"
                            class="flex items-center gap-2 text-indigo-400 hover:text-indigo-600 text-sm font-medium px-2 py-1"><i
                                class="ph-bold ph-plus-circle"></i> æ–°å¢è¡Œç¨‹</button>
                    </div>
                </div>
            </transition>

            <!-- VIEW: éƒµè¼ªæ”»ç•¥ (Guide) -->
            <div v-if="viewMode === 'guide'" class="p-4 pb-24 space-y-6">
                <!-- æ¨™é¡Œèˆ‡åˆ‡æ› -->
                <div class="bg-gradient-to-r from-blue-600 to-cyan-500 rounded-2xl p-6 text-white shadow-lg mb-6">
                    <h2 class="text-2xl font-bold flex items-center gap-2"><i class="ph-duotone ph-boat"></i> NCL Bliss
                        æ”»ç•¥</h2>
                    <p class="text-blue-100 text-xs mt-1 mb-4">è¨­æ–½ã€ç¾é£Ÿèˆ‡å¥åº·æŒ‡å—</p>

                    <div class="flex gap-2 text-xs font-bold">
                        <button @click="guideTab = 'decks'"
                            :class="guideTab === 'decks' ? 'bg-white text-blue-600' : 'bg-blue-700/50 text-blue-100'"
                            class="px-4 py-2 rounded-lg transition">ç”²æ¿åœ°åœ–</button>
                        <button @click="guideTab = 'health'"
                            :class="guideTab === 'health' ? 'bg-white text-blue-600' : 'bg-blue-700/50 text-blue-100'"
                            class="px-4 py-2 rounded-lg transition">å¥åº·èˆ‡è¨­æ–½</button>
                    </div>
                </div>

                <!-- TAB: ç”²æ¿åœ°åœ– (Decks) -->
                <div v-if="guideTab === 'decks'" class="space-y-4">
                    <p class="text-xs text-slate-400 text-center mb-2">é»æ“Šå±¤æ•¸æŸ¥çœ‹è©³ç´°è¨­æ–½åˆ†ä½ˆèˆ‡æ¨è–¦ç¾é£Ÿ</p>

                    <div v-for="deck in shipDecks" :key="deck.level"
                        class="bg-white rounded-xl shadow-sm border border-slate-100 overflow-hidden">
                        <!-- ç”²æ¿æ¨™é¡Œ (å¯é»æ“Šå±•é–‹) -->
                        <div @click="deck.open = !deck.open"
                            class="bg-slate-50 px-4 py-3 flex justify-between items-center cursor-pointer hover:bg-slate-100 transition">
                            <div class="flex items-center gap-3">
                                <div
                                    class="w-8 h-8 rounded-full bg-indigo-600 text-white flex items-center justify-center font-bold font-mono">
                                    {{ deck.level }}</div>
                                <span class="font-bold text-slate-700">{{ deck.name }}</span>
                            </div>
                            <i :class="deck.open ? 'ph-caret-up' : 'ph-caret-down'" class="ph-bold text-slate-400"></i>
                        </div>

                        <!-- å±•é–‹å…§å®¹ (åœ°åœ–ç¤ºæ„) -->
                        <div v-show="deck.open" class="p-4 bg-white">
                            <!-- èˆ¹é ­åˆ°èˆ¹å°¾çš„ç¤ºæ„åœ– -->
                            <div
                                class="flex flex-col gap-1 relative border-l-2 border-dashed border-indigo-100 ml-2 pl-6 py-2">
                                <!-- Forward (èˆ¹é ­) -->
                                <div class="relative group">
                                    <div
                                        class="absolute -left-[31px] top-1 w-4 h-4 rounded-full bg-indigo-100 border-2 border-indigo-300 flex items-center justify-center text-[8px] font-bold text-indigo-600">
                                        å‰</div>
                                    <div class="mb-4" v-if="deck.forward.length > 0">
                                        <span
                                            class="text-xs font-bold text-indigo-400 uppercase tracking-wider block mb-1">FORWARD
                                            (èˆ¹é ­)</span>
                                        <div class="space-y-2">
                                            <div v-for="loc in deck.forward"
                                                class="text-sm py-2 px-3 rounded border border-slate-100 bg-slate-50 relative">
                                                <div class="flex justify-between items-start">
                                                    <span class="font-bold">{{ loc.name }}</span>
                                                    <span v-if="loc.free"
                                                        class="text-[10px] bg-green-100 text-green-600 px-1.5 rounded font-bold">Free</span>
                                                    <span v-else
                                                        class="text-[10px] bg-amber-50 text-amber-600 px-1.5 rounded font-bold">$</span>
                                                </div>
                                                <div v-if="loc.note"
                                                    class="text-xs text-slate-500 mt-1 flex items-start gap-1">
                                                    <i
                                                        class="ph-fill ph-star text-orange-400 text-xs shrink-0 mt-0.5"></i>
                                                    {{ loc.note }}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Mid (èˆ¹ä¸­) -->
                                <div class="relative group">
                                    <div
                                        class="absolute -left-[31px] top-1 w-4 h-4 rounded-full bg-indigo-100 border-2 border-indigo-300 flex items-center justify-center text-[8px] font-bold text-indigo-600">
                                        ä¸­</div>
                                    <div class="mb-4" v-if="deck.mid.length > 0">
                                        <span
                                            class="text-xs font-bold text-indigo-400 uppercase tracking-wider block mb-1">MIDSHIP
                                            (èˆ¹ä¸­)</span>
                                        <div class="space-y-2">
                                            <div v-for="loc in deck.mid"
                                                class="text-sm py-2 px-3 rounded border border-slate-100 bg-slate-50 relative">
                                                <div class="flex justify-between items-start">
                                                    <span class="font-bold">{{ loc.name }}</span>
                                                    <span v-if="loc.free"
                                                        class="text-[10px] bg-green-100 text-green-600 px-1.5 rounded font-bold">Free</span>
                                                    <span v-else
                                                        class="text-[10px] bg-amber-50 text-amber-600 px-1.5 rounded font-bold">$</span>
                                                </div>
                                                <div v-if="loc.note"
                                                    class="text-xs text-slate-500 mt-1 flex items-start gap-1">
                                                    <i
                                                        class="ph-fill ph-star text-orange-400 text-xs shrink-0 mt-0.5"></i>
                                                    {{ loc.note }}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Aft (èˆ¹å°¾) -->
                                <div class="relative group">
                                    <div
                                        class="absolute -left-[31px] top-1 w-4 h-4 rounded-full bg-indigo-100 border-2 border-indigo-300 flex items-center justify-center text-[8px] font-bold text-indigo-600">
                                        å¾Œ</div>
                                    <div v-if="deck.aft.length > 0">
                                        <span
                                            class="text-xs font-bold text-indigo-400 uppercase tracking-wider block mb-1">AFT
                                            (èˆ¹å°¾)</span>
                                        <div class="space-y-2">
                                            <div v-for="loc in deck.aft"
                                                class="text-sm py-2 px-3 rounded border border-slate-100 bg-slate-50 relative">
                                                <div class="flex justify-between items-start">
                                                    <span class="font-bold">{{ loc.name }}</span>
                                                    <span v-if="loc.free"
                                                        class="text-[10px] bg-green-100 text-green-600 px-1.5 rounded font-bold">Free</span>
                                                    <span v-else
                                                        class="text-[10px] bg-amber-50 text-amber-600 px-1.5 rounded font-bold">$</span>
                                                </div>
                                                <div v-if="loc.note"
                                                    class="text-xs text-slate-500 mt-1 flex items-start gap-1">
                                                    <i
                                                        class="ph-fill ph-star text-orange-400 text-xs shrink-0 mt-0.5"></i>
                                                    {{ loc.note }}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- TAB: å¥åº·èˆ‡è¨­æ–½ (Health & Info) -->
                <div v-if="guideTab === 'health'" class="space-y-6 animate-fade-in">
                    <!-- å¥åº·æ§é‡ -->
                    <div class="bg-white rounded-xl shadow-sm border border-slate-100 overflow-hidden">
                        <div class="bg-emerald-50 px-4 py-3 border-b border-emerald-100 flex items-center gap-2">
                            <i class="ph-fill ph-heartbeat text-emerald-600 text-xl"></i>
                            <h3 class="font-bold text-emerald-800">ä½ç¢³é«˜è›‹ç™½æ§é‡æŒ‡å—</h3>
                        </div>
                        <div class="p-4 prose text-sm text-slate-600">
                            <div class="mb-3">
                                <strong class="text-slate-800 block mb-1">Garden CafÃ© (Deck 16) ç­–ç•¥ï¼š</strong>
                                <ul class="list-disc pl-4 space-y-1">
                                    <li><strong>ç¬¬ä¸€åœˆåªæ‹¿ï¼š</strong>ç”Ÿèœæ²™æ‹‰ã€æ·±è‰²è”¬èœã€çƒ¤è‚‰å€çš„ç‰›æ’/é›èƒ¸/é­šæ’ã€‚</li>
                                    <li><strong>é¿é–‹æ¾±ç²‰ï¼š</strong>éºµåŒ…å€ã€ç¾©å¤§åˆ©éºµã€é¦¬éˆ´è–¯æ³¥ã€Pizzaã€‚</li>
                                    <li><strong>æ—©é¤æ¨è–¦ï¼š</strong>ç¾åš Omelet (å…¨åŠ æ–™ä¸åŠ èµ·å¸) + ç‡»é®­é­š + é»‘å’–å•¡ã€‚</li>
                                </ul>
                            </div>
                            <div>
                                <strong class="text-slate-800 block mb-1">ä¸»é¤å»³ (Taste/Savor) é»é¤ï¼š</strong>
                                <ul class="list-disc pl-4 space-y-1">
                                    <li>ä¸»é¤é¸<strong>ç‰›æ’ (Steak) æˆ– çƒ¤é­š (Grilled Fish)</strong>ã€‚</li>
                                    <li>é…èœè–¯æ¢æ›æˆã€ŒSteamed Vegetables (è’¸è”¬èœ)ã€ã€‚</li>
                                    <li>ç”œé»è·³éè›‹ç³•ï¼Œé¸ã€Œèµ·å¸ç›¤ (Cheese Plate)ã€æˆ–ã€Œç„¡ç³–å†°æ·‡æ·‹ã€ã€‚</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- èˆ¹ä¸Šè¨­æ–½ -->
                    <div class="bg-white rounded-xl shadow-sm border border-slate-100 overflow-hidden">
                        <div class="bg-sky-50 px-4 py-3 border-b border-sky-100 flex items-center gap-2">
                            <i class="ph-fill ph-game-controller text-sky-600 text-xl"></i>
                            <h3 class="font-bold text-sky-800">å¿…ç©è¨­æ–½ (éœ€é ç´„)</h3>
                        </div>
                        <div class="p-4 grid grid-cols-2 gap-3">
                            <div class="bg-slate-50 p-3 rounded-lg text-center border border-slate-100">
                                <div class="text-2xl mb-1">ğŸï¸</div>
                                <div class="font-bold text-sm">æµ·ä¸Šè³½è»Š</div>
                                <div class="text-[10px] text-slate-400">Race Track (Deck 19)</div>
                            </div>
                            <div class="bg-slate-50 p-3 rounded-lg text-center border border-slate-100">
                                <div class="text-2xl mb-1">ğŸ”«</div>
                                <div class="font-bold text-sm">é›·å°„æ§æˆ°</div>
                                <div class="text-[10px] text-slate-400">Laser Tag (Deck 18)</div>
                            </div>
                            <div class="bg-slate-50 p-3 rounded-lg text-center border border-slate-100">
                                <div class="text-2xl mb-1">ğŸŒŠ</div>
                                <div class="font-bold text-sm">æ°´ä¸Šæ»‘æ¢¯</div>
                                <div class="text-[10px] text-slate-400">Ocean Loops (Deck 16)</div>
                            </div>
                            <div class="bg-slate-50 p-3 rounded-lg text-center border border-slate-100">
                                <div class="text-2xl mb-1">ğŸ­</div>
                                <div class="font-bold text-sm">ç™¾è€åŒ¯ç§€</div>
                                <div class="text-[10px] text-slate-400">Bliss Theater (Deck 7)</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- VIEW: è³¼ç‰©/å¾…è¾¦æ¸…å–® (Shop & Todo) -->
            <div v-if="viewMode === 'shop'" class="p-4 pb-24 space-y-6">
                <!-- è—¥å¦å¿…è²·å€ -->
                <div>
                    <h2 class="text-xl font-bold text-slate-800 mb-3 flex items-center gap-2">
                        <i class="ph-duotone ph-pill text-rose-500"></i> ç¾åœ‹è—¥å¦çµ‚æ¥µæ¡è³¼
                    </h2>
                    <div class="space-y-4">
                        <div v-for="(group, gIdx) in shoppingGroups" :key="gIdx"
                            class="bg-white rounded-xl shadow-sm border border-slate-100 overflow-hidden">
                            <div
                                class="bg-rose-50 px-4 py-2 border-b border-rose-100 flex justify-between items-center">
                                <span class="text-sm font-bold text-rose-700">{{ group.category }}</span>
                                <span class="text-[10px] bg-white px-2 py-0.5 rounded-full text-rose-400">{{
                                    group.items.filter(i=>i.done).length }}/{{ group.items.length }}</span>
                            </div>
                            <div class="divide-y divide-slate-50">
                                <label v-for="(item, iIdx) in group.items" :key="iIdx"
                                    class="flex items-start gap-3 p-3 cursor-pointer hover:bg-slate-50 transition">
                                    <div class="pt-1">
                                        <input type="checkbox" v-model="item.done"
                                            class="w-5 h-5 rounded text-rose-500 focus:ring-rose-500 border-slate-300">
                                    </div>
                                    <div class="flex-1">
                                        <!-- å•†å“åœ–ç‰‡ -->
                                        <div v-if="item.image"
                                            class="mb-2 w-full h-32 bg-white rounded-lg border border-slate-100 flex items-center justify-center overflow-hidden">
                                            <img :src="item.image" class="h-full object-contain" alt="å•†å“åœ–ç‰‡">
                                        </div>
                                        <div class="font-bold text-sm text-slate-700"
                                            :class="{'line-through text-slate-400': item.done}">{{ item.name }}</div>
                                        <div class="text-xs text-slate-500 mt-0.5">{{ item.desc }}</div>
                                        <div
                                            class="text-[10px] font-mono font-bold text-rose-500 mt-1 bg-rose-50 inline-block px-1.5 rounded">
                                            ~{{ item.price }}</div>
                                    </div>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- å¾…è¾¦äº‹é …å€ -->
                <div>
                    <h2 class="text-xl font-bold text-slate-800 mb-3 flex items-center gap-2">
                        <i class="ph-duotone ph-check-square text-emerald-500"></i> è¡Œå‰ To-Do
                    </h2>
                    <div class="bg-white rounded-xl shadow-sm border border-slate-100 divide-y divide-slate-100">
                        <label v-for="(todo, tIdx) in todos" :key="tIdx"
                            class="flex items-center gap-3 p-4 cursor-pointer hover:bg-slate-50 transition">
                            <input type="checkbox" v-model="todo.done"
                                class="w-5 h-5 rounded text-emerald-500 focus:ring-emerald-500 border-slate-300">
                            <span class="text-sm font-medium text-slate-700 flex-1"
                                :class="{'line-through text-slate-400': todo.done}">{{ todo.text }}</span>
                            <span v-if="todo.tag"
                                class="text-[10px] px-2 py-0.5 bg-slate-100 text-slate-500 rounded-full">{{ todo.tag
                                }}</span>
                        </label>
                    </div>
                </div>
            </div>

            <!-- VIEW: åœ°åœ– (Map) -->
            <div v-if="viewMode === 'map'" class="h-full flex flex-col relative">
                <div id="map" class="flex-1 w-full h-full bg-slate-200 z-0"></div>
                <div v-if="isMapLoading"
                    class="absolute inset-0 bg-white/50 backdrop-blur-sm z-10 flex flex-col items-center justify-center text-indigo-600">
                    <i class="ph-duotone ph-spinner animate-spin text-4xl mb-2"></i><span
                        class="text-xs font-bold">è¼‰å…¥åœ°é»ä¸­...</span></div>
                <div
                    class="absolute bottom-20 left-4 right-4 bg-white/90 backdrop-blur rounded-xl p-3 shadow-lg border border-white/50 z-10 flex justify-between items-center">
                    <div class="text-sm font-bold text-slate-800">ğŸ“ åœ°åœ–ä¸Šæœ‰ {{ mapMarkersCount }} å€‹æ¨™è¨˜</div>
                    <div class="flex gap-2">
                        <button @click="initMap" class="p-2 bg-indigo-100 text-indigo-600 rounded-lg"><i
                                class="ph-bold ph-arrows-clockwise"></i></button>
                    </div>
                </div>
            </div>

            <!-- VIEW: åˆ†å¸³ (Money) -->
            <div v-if="viewMode === 'money'" class="p-4 pb-24">
                <!-- (ä¿ç•™åŸæœ‰çš„åˆ†å¸³åŠŸèƒ½) -->
                <div class="bg-emerald-600 text-white rounded-2xl p-6 shadow-lg mb-6 text-center relative">
                    <div class="absolute top-4 right-4 flex flex-col items-end">
                        <label class="text-[10px] text-emerald-200 mb-1">åŒ¯ç‡ (USD)</label>
                        <input v-model.number="exchangeRate" type="number"
                            class="w-16 text-right text-xs text-emerald-900 rounded px-1 py-0.5">
                    </div>
                    <div class="text-sm opacity-80 mb-1">ç¸½æ”¯å‡º Total</div>
                    <div class="text-4xl font-bold font-mono">$ {{ totalExpense.toLocaleString() }}</div>
                    <div class="text-lg font-bold text-emerald-200 mt-1">â‰ˆ NT$ {{ Math.round(totalExpense *
                        exchangeRate).toLocaleString() }}</div>
                </div>

                <div class="bg-white rounded-xl shadow-sm p-4 mb-6 border border-slate-100">
                    <h3 class="text-sm font-bold text-slate-700 mb-3">æ–°å¢æ¶ˆè²»</h3>
                    <div class="flex gap-2 mb-2">
                        <input v-model="newExpense.item" placeholder="é …ç›® (å¦‚: Uber)"
                            class="flex-1 bg-slate-50 border-none rounded-lg text-sm px-3 py-2">
                        <select v-model="newExpense.payer"
                            class="w-20 bg-slate-50 border-none rounded-lg text-sm px-1 py-2">
                            <option value="æˆ‘">æˆ‘</option>
                            <option value="å…¬è²»">å…¬è²»</option>
                        </select>
                    </div>
                    <div class="flex gap-2">
                        <input v-model.number="newExpense.amount" type="number" placeholder="USD é‡‘é¡"
                            class="w-full bg-slate-50 border-none rounded-lg text-sm pl-3 pr-3 py-2 font-mono">
                        <button @click="addExpense"
                            class="bg-emerald-600 hover:bg-emerald-700 text-white px-4 py-2 rounded-lg font-bold"><i
                                class="ph-bold ph-plus"></i></button>
                    </div>
                </div>

                <div class="space-y-3">
                    <div v-for="(exp, idx) in expenses" :key="idx"
                        class="flex justify-between items-center bg-white p-3 rounded-xl border border-slate-100 shadow-sm">
                        <div class="flex items-center gap-3">
                            <div
                                class="w-8 h-8 rounded-full bg-emerald-50 flex items-center justify-center text-emerald-600 text-xs font-bold">
                                {{ exp.payer.charAt(0) }}</div>
                            <div>
                                <div class="font-bold text-slate-700 text-sm">{{ exp.item }}</div>
                            </div>
                        </div>
                        <div class="flex items-center gap-3">
                            <span class="font-mono font-bold text-slate-700">$ {{ exp.amount.toLocaleString() }}</span>
                            <button @click="removeExpense(idx)" class="text-slate-300 hover:text-red-400"><i
                                    class="ph-fill ph-x-circle"></i></button>
                        </div>
                    </div>
                </div>
            </div>

        </main>

    </div>

    <script type="module">
        import { createApp, ref, computed, watch, onMounted, nextTick } from 'https://unpkg.com/vue@3/dist/vue.esm-browser.js'

        createApp({
            setup() {
                const viewMode = ref('plan');
                const guideTab = ref('decks'); // NEW: Guide tab control
                const currentDayIdx = ref(0);
                const weather = ref({ temp: null, code: 0 });
                const mapMarkersCount = ref(0);

                // --- KML åŒ¯å…¥åœ°é»è³‡æ–™ ---
                const kmlLocations = [
                    { name: 'æ´›æ‰ç£¯æ©Ÿå ´æ™ºé¸å‡æ—¥é…’åº—', lat: 33.9591689, lng: -118.3850236 },
                    { name: 'æ´›æ‰ç£¯åœ‹éš›æ©Ÿå ´', lat: 33.942153, lng: -118.4036052 },
                    { name: 'LA æ¸¯å£ (Cruise Center)', lat: 33.7475041, lng: -118.2772079 },
                    { name: 'å¡æ³¢è–ç›§å¡æ–¯ (Cabo)', lat: 22.8788929, lng: -109.9074626 },
                    { name: 'é¦¬è–©ç‰¹è˜­ (Mazatlan)', lat: 23.1929344, lng: -106.4174812 },
                    { name: 'å·´äºçˆ¾å¡”æ¸¯ (Puerto Vallarta)', lat: 20.6533354, lng: -105.2407708 },
                    { name: 'è¯åˆè»Šç«™ (Union Station)', lat: 34.0562196, lng: -118.2365021 },
                    { name: 'æ ¼é‡Œæ–æ–¯å¤©æ–‡å°', lat: 34.1184341, lng: -118.3003935 },
                    { name: 'è“‹è’‚ä¸­å¿ƒ', lat: 34.0773438, lng: -118.4732648 },
                    { name: 'Grand Central Market', lat: 34.050872, lng: -118.2490552 },
                    { name: 'æ ¼é‡Œæ–æ–¯å…¬åœ’', lat: 34.1365544, lng: -118.2942 },
                    { name: 'è–è«å°¼å¡ç¢¼é ­', lat: 34.0082821, lng: -118.4987585 },
                    { name: 'å¸ƒæ´›å¾·åšç‰©é¤¨ (The Broad)', lat: 34.0545021, lng: -118.2501802 },
                    { name: 'è¯ç‰¹Â·è¿ªå£«å°¼éŸ³æ¨‚å»³', lat: 34.0553454, lng: -118.249845 },
                    { name: 'The Last Bookstore', lat: 34.0476964, lng: -118.2498964 },
                    { name: 'Citadel Outlets', lat: 34.0073187, lng: -118.1529856 },
                    { name: 'Shake Shack Downtown LA', lat: 34.0444873, lng: -118.2561395 },
                    { name: 'Lake Hollywood Park', lat: 34.1269448, lng: -118.3261053 },
                    { name: 'LA Airbnb ä½å®¿', lat: 34.0379675, lng: -118.141664 },
                    { name: 'è¿ªå£«å°¼åŠ å·å†’éšªæ¨‚åœ’', lat: 33.8062236, lng: -117.9199281 }
                ];

                // --- 2026 è¡Œç¨‹è³‡æ–™åˆå§‹åŒ– ---
                const initData = [
                    { date: '02/11 (ä¸‰)', shortDate: '2/11', title: 'å‡ºç™¼æ—¥ / æŠµé” LA', flight: { startTime: '23:40', startAirport: 'TPE', number: 'JX2', endTime: '19:00', endAirport: 'LAX', arrivalOffset: 0 }, items: [{ time: '18:00', type: 'transport', activity: 'å‰å¾€æ¡ƒåœ’æ©Ÿå ´', location: 'TPE Airport', note: 'è¨˜å¾—æ‹¿WiFiæ©Ÿ' }, { time: '19:00', type: 'flight', activity: 'æŠµé” LAX', location: 'LAX Airport', note: 'å…¥å¢ƒæª¢æŸ¥' }, { time: '20:30', type: 'hotel', activity: 'Check-in é£¯åº—', location: 'Holiday Inn Express Los Angeles LAX Airport', note: 'è‡³ Upper Level (å‡ºå¢ƒå±¤) ç´…è‰² \'Hotel Shuttles\' æ¨™ç¤ºæ­ä¹˜ (æ¯30åˆ†ä¸€ç­)' }, { time: '21:00', type: 'shop', activity: 'è¶…å¸‚æ¡è²·: Trader Joe\'s & Target', location: '8611 S Sepulveda Blvd', note: 'å°±åœ¨é£¯åº—é™„è¿‘ï¼Œè²·æ°´/é›¶é£Ÿ/æ—©é¤' }] },
                    {
                        date: '02/12 (å››)', shortDate: '2/12', title: 'LA å¸‚å€ / LADT æ¢ç´¢', items: [
                            { time: '09:00', type: 'hotel', activity: 'Check-out é£¯åº—', location: 'Holiday Inn Express LAX', note: 'å¸¶å¥½è¡Œæ' },
                            { time: '09:30', type: 'transport', activity: 'æ­ä¹˜ LAX FlyAway å·´å£«', location: 'LAX FlyAway Bus Stop', note: 'è‡³ Lower Level (å…¥å¢ƒå±¤) ç¶ è‰²æŸ±å­æ­è»Š', link: 'https://www.flylax.com/flyaway-bus' },
                            { time: '10:30', type: 'spot', activity: 'æŠµé”è¯åˆè»Šç«™ & å¯„æ”¾è¡Œæ', location: 'Los Angeles Union Station', note: 'æœå°‹ Bounce/Radical Storage', link: 'https://bounce.com/luggage-storage/los-angeles/union-station-la' },
                            { time: '11:00', type: 'spot', activity: 'å¤©ä½¿éµè·¯ (Angels Flight)', location: 'Angels Flight Railway', note: 'La La Land å ´æ™¯ / å–®ç¨‹$1' },
                            { time: '11:30', type: 'food', activity: 'Grand Central Market åˆé¤', location: 'Grand Central Market', note: 'å¿…åƒ: Eggslut æ¼¢å ¡' },
                            { time: '12:30', type: 'food', activity: 'Blue Bottle Coffee', location: 'Blue Bottle Coffee Bradbury', note: 'å¸ƒé›·å¾·ä¼¯é‡Œå¤§æ¨“åº— / æ‹¿éµ' },
                            { time: '13:00', type: 'spot', activity: 'The Broad åšç‰©é¤¨', location: 'The Broad', note: 'ç•¶ä»£è—è¡“ / è‰é–“å½Œç”Ÿ (éœ€é ç´„)' },
                            { time: '14:30', type: 'spot', activity: 'è¿ªå£«å°¼éŸ³æ¨‚å»³', location: 'Walt Disney Concert Hall', note: 'å¤–è§€æ‹ç…§ (é‡‘å±¬å»ºç¯‰)' },
                            { time: '15:00', type: 'spot', activity: 'æœ€å¾Œæ›¸åº— The Last Bookstore', location: 'The Last Bookstore', note: 'æ›¸æœ¬éš§é“ / IGç†±é»' },
                            { time: '16:00', type: 'transport', activity: 'å›è¯åˆè»Šç«™å–è¡Œæ', location: 'Union Station', note: '' },
                            { time: '16:30', type: 'transport', activity: 'å‰å¾€ Airbnb', location: 'LA Airbnb ä½å®¿', note: 'å« Uber/Lyft', link: 'https://www.airbnb.com.tw/rooms/883532373041404930' },
                            { time: '17:30', type: 'hotel', activity: 'Airbnb Check-in', location: 'LA Airbnb ä½å®¿', note: 'ä½åˆ° 2/15 (Montebelloé™„è¿‘)' }
                        ]
                    },
                    { date: '02/13 (äº”)', shortDate: '2/13', title: 'Santa Monica & Outlet', items: [{ time: '11:00', type: 'spot', activity: 'Santa Monica Pier', location: 'Santa Monica Pier', note: 'æµ·ç˜ã€ç¢¼é ­' }, { time: '15:00', type: 'shop', activity: 'Citadel Outlets', location: 'Citadel Outlets', note: 'Outlet è³¼ç‰©' }, { time: '20:00', type: 'hotel', activity: 'å› Airbnb', location: 'LA Airbnb ä½å®¿', note: '' }] },
                    {
                        date: '02/14 (å…­)', shortDate: '2/14', title: 'Disneyland è¿ªå£«å°¼ (LLæ”»ç•¥)', items: [
                            { time: '07:30', type: 'transport', activity: 'æŠµé”åœ’å€ (Rope Drop)', location: 'Disneyland Park', note: 'ææ—©éå®‰æª¢ / è¨˜å¾—ç§Ÿè¡Œå‹•é›»æº' },
                            { time: '08:00', type: 'spot', activity: 'âš¡ï¸ æ˜Ÿéš›å¤§æˆ°ï¼šåæŠ—è»èµ·ç¾©', location: 'Star Wars: Rise of the Resistance', note: 'å¿…ç©ç¬¬ä¸€å / å»ºè­°è²·å–®æ¬¡LL' },
                            { time: '09:00', type: 'spot', activity: 'âš¡ï¸ å°ç¬¬å®‰ç´ç“Šæ–¯å†’éšª', location: 'Indiana Jones Adventure', note: 'LL è¨­æ–½ / åˆºæ¿€å‰æ™®è»Š' },
                            { time: '10:30', type: 'spot', activity: 'âš¡ï¸ ç±³å¥‡ç±³å¦®é£›é€Ÿéµè·¯', location: 'Mickey & Minnie\'s Runaway Railway', note: 'LL è¨­æ–½ / Toontown / é©åˆå…¨å®¶' },
                            { time: '12:00', type: 'food', activity: 'åˆé¤: Docking Bay 7', location: 'Docking Bay 7 Food and Cargo', note: 'æ˜Ÿæˆ°ä¸»é¡Œé¤å»³ / ç‚¸é›å¥½å–«' },
                            { time: '13:00', type: 'spot', activity: 'ğŸ“¸ æ‹ç…§é»: åƒå¹´é·¹è™Ÿ', location: 'Millennium Falcon: Smugglers Run', note: 'æ˜Ÿæˆ°å€åœ°æ¨™ / æ—é‚Šå–è—ç‰›å¥¶' },
                            { time: '13:30', type: 'spot', activity: 'âš¡ï¸ åƒå¹´é·¹è™Ÿï¼šèµ°ç§è€…é€ƒäº¡', location: 'Millennium Falcon: Smugglers Run', note: 'LL è¨­æ–½ / æ¨¡æ“¬é£›è¡Œ' },
                            { time: '15:00', type: 'spot', activity: 'éŠè¡Œ: Magic Happens', location: 'Main Street, U.S.A.', note: '15:30 æˆ– 18:00 (è«‹ç¢ºèªç•¶æ—¥APP) / è¿ªå£«å°¼å¿…çœ‹éŠè¡Œ' },
                            { time: '16:00', type: 'shop', activity: 'ğŸ›ï¸ å¿…è²·: æ˜Ÿå·´å…‹ & é«®ç®', location: 'Market House', note: 'è¿ªå£«å°¼é™å®šæ¯ / Emporium è²·è€³æœµé«®ç®' },
                            { time: '17:00', type: 'spot', activity: 'âš¡ï¸ å¤ªç©ºå±± Space Mountain', location: 'Space Mountain Disneyland', note: 'LL è¨­æ–½ / å®¤å…§é›²éœ„é£›è»Š' },
                            { time: '18:30', type: 'spot', activity: 'ğŸ“¸ æ‹ç…§é»: ç¡ç¾äººåŸå ¡', location: 'Sleeping Beauty Castle', note: 'é»ƒæ˜/é»ç‡ˆæ™‚åˆ»æœ€ç¾ / Partners é›•åƒ' },
                            { time: '19:30', type: 'spot', activity: 'âš¡ï¸ é¦¬ç‰¹æ´ªå³°é›ªæ©‡', location: 'Matterhorn Bobsleds', note: 'LL è¨­æ–½ / ç¶“å…¸é›ªæ€ªé£›è»Š' },
                            { time: '21:30', type: 'spot', activity: 'ğŸ‡ ç…™ç«ç§€ / å…‰å½±ç§€', location: 'Main Street, U.S.A.', note: 'åŸå ¡å‰ä½”ä½ / çµæŸå¾Œäººæ½®å¤š' },
                            { time: '22:30', type: 'hotel', activity: 'å› Airbnb', location: 'LA Airbnb ä½å®¿', note: 'æœ€å¾Œä¸€æ™š' }
                        ]
                    },
                    { date: '02/15 (æ—¥)', shortDate: '2/15', title: 'ç™»èˆ¹æ—¥ (NCL)', items: [{ time: '10:00', type: 'transport', activity: 'é€€æˆ¿å‰å¾€æ¸¯å£', location: 'LA Airbnb ä½å®¿', note: 'Uber' }, { time: '11:00', type: 'transport', activity: 'ç™»èˆ¹æ‰‹çºŒ (11:00-11:30)', location: 'San Pedro World Cruise Center', note: 'æº–æ™‚æŠµé”!' }, { time: '16:00', type: 'spot', activity: 'éƒµè¼ªé›¢æ¸¯', location: '', note: 'NCL Joy/Bliss' }] },
                    { date: '02/16 (ä¸€)', shortDate: '2/16', title: 'æµ·ä¸Šå·¡éŠ At Sea', items: [{ time: '', type: 'spot', activity: 'äº«å—èˆ¹ä¸Šè¨­æ–½', location: '', note: 'æ³³æ± ã€ç§€å ´' }] },
                    { date: '02/17 (äºŒ)', shortDate: '2/17', title: 'Cabo San Lucas', items: [{ time: '11:00', type: 'spot', activity: 'æŠµé” Cabo', location: 'Cabo San Lucas', note: 'å¢¨è¥¿å“¥' }, { time: '19:00', type: 'spot', activity: 'é›¢æ¸¯', location: '', note: '' }] },
                    { date: '02/18 (ä¸‰)', shortDate: '2/18', title: 'MazatlÃ¡n', items: [{ time: '08:00', type: 'spot', activity: 'æŠµé” MazatlÃ¡n', location: 'MazatlÃ¡n', note: 'å¢¨è¥¿å“¥' }, { time: '18:00', type: 'spot', activity: 'é›¢æ¸¯', location: '', note: '' }] },
                    { date: '02/19 (å››)', shortDate: '2/19', title: 'Puerto Vallarta', items: [{ time: '08:00', type: 'spot', activity: 'æŠµé” Puerto Vallarta', location: 'Puerto Vallarta', note: 'å¢¨è¥¿å“¥' }, { time: '18:00', type: 'spot', activity: 'é›¢æ¸¯', location: '', note: '' }] },
                    { date: '02/20 (äº”)', shortDate: '2/20', title: 'æµ·ä¸Šå·¡éŠ At Sea', items: [{ time: '', type: 'spot', activity: 'æµ·ä¸Šæ”¾é¬†', location: '', note: '' }] },
                    { date: '02/21 (å…­)', shortDate: '2/21', title: 'æµ·ä¸Šå·¡éŠ At Sea', items: [{ time: '', type: 'spot', activity: 'æ•´ç†è¡Œæ', location: '', note: '' }] },
                    { date: '02/22 (æ—¥)', shortDate: '2/22', title: 'ä¸‹èˆ¹ & å›ç¨‹', flight: { startTime: '22:50', startAirport: 'LAX', number: 'JX1', endTime: '05:30', endAirport: 'TPE', arrivalOffset: 1 }, items: [{ time: '07:00', type: 'transport', activity: 'ä¸‹èˆ¹', location: 'Los Angeles', note: '' }, { time: '08:30', type: 'transport', activity: 'å‰å¾€ Outlet (å¯„æ”¾è¡Œæ)', location: 'Citadel Outlets', note: 'è»Šç¨‹ç´„30åˆ†' }, { time: '10:00', type: 'shop', activity: 'Citadel Outlets é€›è¡—', location: 'Citadel Outlets', note: 'Coach/Nike/MK' }, { time: '13:00', type: 'food', activity: 'åˆé¤', location: 'Citadel Outlets', note: 'ç¾é£Ÿè¡—' }, { time: '16:00', type: 'food', activity: 'In-N-Out Burger', location: 'In-N-Out Burger Sepulveda', note: 'æ©Ÿå ´æ—å¿…åƒ / çœ‹é£›æ©Ÿ' }, { time: '19:00', type: 'transport', activity: 'å‰å¾€æ©Ÿå ´ (LAX)', location: 'LAX Airport', note: 'é ç•™3å°æ™‚å®‰æª¢' }] },
                    { date: '02/23 (ä¸€)', shortDate: '2/23', title: 'é£›æ©Ÿä¸Š', items: [{ time: '', type: 'transport', activity: 'è·¨è¶Šåœ‹éš›æ›æ—¥ç·š', location: '', note: '' }] },
                    { date: '02/24 (äºŒ)', shortDate: '2/24', title: 'æŠµé”å°ç£', items: [{ time: '05:30', type: 'flight', activity: 'æŠµé”æ¡ƒåœ’æ©Ÿå ´', location: 'TPE Airport', note: 'æº«æš–çš„å®¶' }] }
                ];

                // --- NCL æ¨“å±¤è³‡æ–™ (New Data) ---
                const shipDecks = ref([
                    {
                        level: '16', name: 'Deck 16 é ‚å±¤ç”²æ¿', open: true,
                        forward: [{ name: 'Pool Deck (æ³³æ± )', free: true, note: 'ä¸»æ³³æ± /æŒ‰æ‘©æ± ' }, { name: 'Kids Aqua Park', free: true, note: 'å…’ç«¥æˆ²æ°´å€' }],
                        mid: [{ name: 'Surf Bar', free: false }],
                        aft: [{ name: 'Garden CafÃ© (è‡ªåŠ©é¤)', free: true, note: 'å¿…åƒ: ç¾åˆ‡ç‰›æ’/ç¾åšOmelet' }, { name: 'Pulse Fitness Center (å¥èº«æˆ¿)', free: true, note: 'æµ·æ™¯è·‘æ­¥æ©Ÿ' }, { name: 'Spa å…¥å£', free: false }]
                    },
                    {
                        level: '15', name: 'Deck 15 æ™¯è§€å±¤', open: false,
                        forward: [{ name: 'Observation Lounge (è§€æ™¯é…’å»Š)', free: true, note: 'æœ€ä½³æµ·æ™¯ç™¼å‘†å€ (æœ‰è¼•é£Ÿ)' }],
                        mid: [],
                        aft: []
                    },
                    {
                        level: '08', name: 'Deck 8 æµ·æ¿±å¤§é“ (Waterfront)', open: false,
                        forward: [{ name: 'District Brew House', free: false }, { name: 'Food Republic', free: false, note: 'æ¨: éŸ“å¼ç‚¸é›/å£½å¸å·' }],
                        mid: [{ name: 'Sugarcane Mojito Bar', free: false }, { name: 'Ocean Blue (æµ·é®®)', free: false }],
                        aft: [{ name: 'Cagney\'s Steakhouse (ç‰›æ’)', free: false, note: 'æ¨: è‚‹çœ¼ç‰›æ’/æ¾éœ²è–¯æ¢' }, { name: 'Los Lobos (å¢¨è¥¿å“¥)', free: false, note: 'æ¨: æ¡Œé‚Šç¾åšé…ªæ¢¨é†¬' }, { name: 'The Cavern Club (Beatles)', free: true, note: 'Beatles è¡¨æ¼”' }]
                    },
                    {
                        level: '07', name: 'Deck 7 å¨›æ¨‚ä¸­å¿ƒ', open: false,
                        forward: [{ name: 'Bliss Theater (åŠ‡é™¢)', free: true }],
                        mid: [{ name: 'Casino (è³­å ´)', free: false }, { name: 'The Local (24hé¤å»³)', free: true, note: 'æ¨: é›ç¿…/Prime Rib' }, { name: 'Skyline Bar', free: false }],
                        aft: [{ name: 'Manhattan Room (ä¸»é¤å»³)', free: true, note: 'æœ‰ç¾å ´éŸ³æ¨‚/æ¨: ç´ç´„å®¢ç‰›æ’' }]
                    },
                    {
                        level: '06', name: 'Deck 6 å¤§å»³å±¤', open: false,
                        forward: [{ name: 'Q Texas Smokehouse', free: false, note: 'æ¨: ç‰›èƒ¸è‚‰ (Brisket)' }],
                        mid: [{ name: 'Atrium (å¤§å»³)', free: true }, { name: 'Starbucks', free: false }, { name: 'Guest Services', free: true }],
                        aft: [{ name: 'Taste (ä¸»é¤å»³)', free: true, note: 'æ¯æ—¥è®Šæ›ä¸»å»šç‰¹é¤' }, { name: 'Savor (ä¸»é¤å»³)', free: true, note: 'æ¯æ—¥è®Šæ›ä¸»å»šç‰¹é¤' }, { name: 'Mixx Bar', free: false }]
                    }
                ]);

                // --- è—¥å¦èˆ‡å¾…è¾¦æ¸…å–®è³‡æ–™ ---
                const shoppingGroups = ref([
                    {
                        category: 'è‡‰éƒ¨ & é›·å°„è¡“å¾Œ (Face)',
                        items: [
                            { name: 'CeraVe é•·æ•ˆæ½¤æ¾¤ä¿®è­·éœœ (Moisturizing Cream)', desc: '16oz (453g) - ä¹¾è‚Œæ•‘æ˜Ÿ', price: '$18', done: false, image: '1.jpg' },
                            { name: 'CeraVe æº«å’Œæ³¡æ²«æ½”è†šéœ² (Foaming Facial Cleanser)', desc: '12-16oz - æ´—è‡‰', price: '$15', done: false, image: '2.jpg' },
                            { name: 'EltaMD ç´”ç‰©ç†é˜²æ›¬éœœ (UV Physical Broad-Spectrum SPF 41)', desc: '3oz (85g) - æ½¤è‰²æ¬¾', price: '$38', done: false, image: '3.png' },
                            { name: 'CeraVe ä¿®å¾©æ²¹è† (Healing Ointment)', desc: '3-5oz è»Ÿç®¡ - å‚·å£æ€¥æ•‘', price: '$11', done: false, image: '4.png' }
                        ]
                    },
                    {
                        category: 'èº«é«”ä¹¾ç™¬ (Body Psoriasis)',
                        items: [
                            { name: 'CeraVe ä¹¾ç™¬ä¿æ¿•ä¹³éœœ (Psoriasis Moisturizing Cream)', desc: '8oz (227g) - éŠ€æ¨™å»å±‘/å«æ°´æ¥Šé…¸', price: '$25', done: false, image: '5.png' },
                            { name: 'CeraVe æ­¢ç™¢ä¿æ¿•éœœ (Itch Relief Moisturizing Cream)', desc: '12oz (340g) - ç´…æ¨™æ€¥æ•‘', price: '$20', done: false, image: '6.jpg' }
                        ]
                    },
                    {
                        category: 'é ­çš®ä¹¾ç™¬ (Scalp)',
                        items: [
                            { name: 'éœ²å¾—æ¸… T/Sal å»å±‘æ´—é«®ç²¾ (Neutrogena T/Sal Shampoo)', desc: '4.5oz é€æ˜ç“¶', price: '$10', done: false, image: '7.png' },
                            { name: 'Scalpicin é ­çš®æ­¢ç™¢æ¶² (Scalpicin Max Strength)', desc: '1.5oz Max Strength', price: '$10', done: false, image: '8.png' }
                        ]
                    },
                    {
                        category: 'è¿ªå£«å°¼å‘¨é‚Š (Disney Merchandise)',
                        items: [
                            { name: 'Duffy and Friends (é”è²èˆ‡å¥½æœ‹å‹)', desc: 'å» DCA çš„å•†åº—æ‰¾æ‰¾çœ‹', price: 'Varied', done: false, image: 'https://cdn1.parksmedia.wdpromedia.com/media/blog/wp-content/uploads/2023/07/dlr-duffy-and-friends.jpg' },
                            { name: 'Inside Out (è…¦ç­‹æ€¥è½‰å½)', desc: 'å» Pixar Pier çš„ Bing Bong\'s Sweet Stuff', price: 'Varied', done: false, image: 'https://i.pinimg.com/736x/2b/95/8e/2b958e93278923055307733527785532.jpg' }
                        ]
                    },
                    {
                        category: 'Trader Joe\'s å¿…è²· (Must-Haves)',
                        items: [
                            { name: 'Everything but the Bagel Seasoning', desc: 'è¬ç”¨èª¿å‘³ç²‰', price: '$1.99', done: false, image: 'https://www.traderjoes.com/content/dam/trjo/products/m20700/59957.png/jcr:content/renditions/cq5dam.web.1280.1280.png' },
                            { name: 'Dark Chocolate Peanut Butter Cups', desc: 'èŠ±ç”Ÿé†¬é»‘å·§å…‹åŠ›æ¯', price: '$0.99', done: false, image: 'https://www.traderjoes.com/content/dam/trjo/products/m20700/20790.png/jcr:content/renditions/cq5dam.web.1280.1280.png' },
                            { name: 'Speculoos Cookie Butter', desc: 'è“®èŠ±é¤…ä¹¾æŠ¹é†¬', price: '$3.99', done: false, image: 'https://www.traderjoes.com/content/dam/trjo/products/m20700/56965.png/jcr:content/renditions/cq5dam.web.1280.1280.png' },
                            { name: 'Reusable Canvas Bags', desc: 'ç’°ä¿å¸†å¸ƒè¢‹', price: '$3.99', done: false, image: 'https://m.media-amazon.com/images/I/71Y+P9-XyLL.jpg' }
                        ]
                    },
                    {
                        category: 'é›¶é£Ÿèˆ‡ä¼´æ‰‹ç¦® (Snacks & Souvenirs)',
                        items: [
                            { name: 'Natrol Melatonin (è¤ªé»‘æ¿€ç´ )', desc: 'åŠ©çœ ç¥å™¨/å¤šç¨®åŠ‘é‡å¯é¸', price: '$10', done: false, image: 'https://images.natrol.com/images/products/melatonin-fast-dissolve-5mg-strawberry-90ct-bottle.png' }
                        ]
                    }
                ]);

                const todos = ref([
                    { text: 'LA é›»å­ç°½è­‰ (ESTA)', done: false, tag: 'é‡è¦' },
                    { text: 'å‡ºåœ‹å‰è¨­å®šå¥½ eSIM (è²·18å¤©)', done: false, tag: 'ç¶²è·¯' },
                    { text: 'æ›ç¾å…ƒ (USD)', done: false, tag: 'éŒ¢' },
                    { text: 'å¤§é ­è­·ç…§ç…§ç‰‡ x3', done: false, tag: 'å‚™ç”¨' },
                    { text: 'é›»å­æ©Ÿç¥¨ã€é£¯åº—ä½å®¿å–®å­˜æ‰‹æ©Ÿ', done: false, tag: 'æ–‡ä»¶' },
                    { text: 'è½‰æ¥æ’é ­ (ç¾åœ‹ Type A/B)', done: false, tag: 'è¡Œæ' },
                    { text: 'ç‰™åˆ·ã€ç‰™è†ã€æ´—é¢ä¹³ (ç¾åœ‹é£¯åº—ä¸ä¸€å®šæœ‰)', done: false, tag: 'è¡Œæ' }
                ]);

                // --- ç‹€æ…‹ ---
                const days = ref(initData);
                const expenses = ref([]);
                const newExpense = ref({ item: '', amount: '', payer: 'æˆ‘' });
                const exchangeRate = ref(32.5); // TWD
                const isMapLoading = ref(false);
                let mapInstance = null;

                // --- Computed ---
                const currentDay = computed(() => days.value[currentDayIdx.value]);
                const totalExpense = computed(() => expenses.value.reduce((sum, e) => sum + e.amount, 0));
                const weatherIcon = computed(() => {
                    const c = weather.value.code;
                    if (c === 0) return 'ph-duotone ph-sun text-yellow-500';
                    if (c <= 3) return 'ph-duotone ph-cloud-sun text-yellow-500';
                    if (c <= 48) return 'ph-duotone ph-cloud text-slate-400';
                    if (c <= 67) return 'ph-duotone ph-cloud-rain text-blue-400';
                    return 'ph-duotone ph-cloud-snow text-sky-200';
                });

                // --- Methods ---
                const getDotColor = (t) => t === 'hotel' ? 'bg-indigo-600' : t === 'shop' ? 'bg-rose-400' : t === 'flight' ? 'bg-sky-500' : 'bg-emerald-500';
                const getTypeLabel = (t) => t === 'hotel' ? 'ä½å®¿' : t === 'shop' ? 'è³¼ç‰©' : t === 'flight' ? 'èˆªç­' : t === 'transport' ? 'äº¤é€š' : 'æ™¯é»';

                const addItem = () => currentDay.value.items.push({ time: '', type: 'spot', activity: '', location: '', note: '' });
                const removeItem = (idx) => currentDay.value.items.splice(idx, 1);

                const addExpense = () => {
                    if (newExpense.value.item && newExpense.value.amount) {
                        expenses.value.unshift({ ...newExpense.value });
                        newExpense.value.item = ''; newExpense.value.amount = '';
                        saveData();
                    }
                };
                const removeExpense = (idx) => { expenses.value.splice(idx, 1); saveData(); };

                // Weather API
                const fetchWeather = async () => {
                    try {
                        const res = await fetch('https://api.open-meteo.com/v1/forecast?latitude=34.05&longitude=-118.24&current_weather=true');
                        const data = await res.json();
                        weather.value = {
                            temp: Math.round(data.current_weather.temperature),
                            code: data.current_weather.weathercode
                        };
                    } catch (e) {
                        console.error('Weather error:', e);
                    }
                };

                // Map Logic
                const initMap = async () => {
                    isMapLoading.value = true;
                    await nextTick();
                    if (!document.getElementById('map')) return;
                    if (mapInstance) { mapInstance.remove(); mapInstance = null; }

                    mapInstance = L.map('map').setView([34.0522, -118.2437], 10); // Default LA
                    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: 'Â© OpenStreetMap' }).addTo(mapInstance);

                    // 1. åŠ å…¥ KML åŒ¯å…¥çš„æ‰€æœ‰åœ°é»
                    const bounds = L.latLngBounds();
                    kmlLocations.forEach(loc => {
                        L.marker([loc.lat, loc.lng]).addTo(mapInstance)
                            .bindPopup(`<b>${loc.name}</b>`).openPopup();
                        bounds.extend([loc.lat, loc.lng]);
                    });

                    // 2. å˜—è©¦ Geocode ç•¶å‰è¡Œç¨‹ä¸­å°šæœªåœ¨ KML ä¸­çš„åœ°é» (å¯é¸)
                    // é€™è£¡ç‚ºäº†æ•ˆèƒ½èˆ‡é¿å…é‡è¤‡ï¼Œä¸»è¦ä¾è³´ KML åŒ¯å…¥çš„ç²¾ç¢ºåº§æ¨™

                    mapMarkersCount.value = kmlLocations.length;

                    if (bounds.isValid()) mapInstance.fitBounds(bounds, { padding: [50, 50] });
                    isMapLoading.value = false;
                };

                // LocalStorage
                const saveData = () => {
                    localStorage.setItem('trip_2026_data', JSON.stringify({
                        days: days.value,
                        expenses: expenses.value,
                        shop: shoppingGroups.value,
                        todo: todos.value
                    }));
                };
                const loadData = () => {
                    const d = localStorage.getItem('trip_2026_data');
                    if (d) {
                        const parsed = JSON.parse(d);
                        if (parsed.expenses) expenses.value = parsed.expenses;
                        // æ³¨æ„ï¼šå¦‚æœæƒ³ä¿ç•™ä¹‹å‰çš„è‡ªè¨‚è¡Œç¨‹ç·¨è¼¯ï¼Œè«‹å–æ¶ˆè¨»è§£ä¸‹è¡Œï¼š
                        // if(parsed.days) days.value = parsed.days; 
                        if (parsed.shop) shoppingGroups.value = parsed.shop;
                        if (parsed.todo) todos.value = parsed.todo;
                    }
                };

                watch([days, expenses, shoppingGroups, todos], saveData, { deep: true });
                watch(viewMode, (v) => { if (v === 'map') initMap(); });
                watch(currentDayIdx, () => { if (viewMode.value === 'map') initMap(); });

                onMounted(() => {
                    loadData();
                    fetchWeather(); // å•Ÿå‹•å¤©æ°£
                });

                return {
                    viewMode, guideTab, currentDayIdx, days, currentDay,
                    expenses, newExpense, addExpense, removeExpense, exchangeRate, totalExpense,
                    shoppingGroups, todos, shipDecks,
                    getDotColor, getTypeLabel, addItem, removeItem,
                    isMapLoading, initMap, weather, weatherIcon, mapMarkersCount
                };
            }
        }).mount('#app')
    </script>
</body>

</html>